<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>type test</title>
    <style>
      /* :root {
        --size: 16px;
      } */
      body {
        margin: 0;
        font-family: monospace;
      }
      .text {
        padding: 16px 20px 132px 20px;
        height: 180px;
        width: 760px;
        font-size: 32px;
        border: 4px solid grey;
        border-radius: 16px;
        background-color: transparent;
        letter-spacing: 1px;
        outline: none;
      }
      ::-webkit-scrollbar {
        width: 0px;
      }
      textarea {
        resize: none;
      }
      #text {
        top: calc(50vh - 172px);
        left: calc(50vw - 520px);
        opacity: 0.6;
        position: absolute;
        width: 760px;
        height: 292px;
        font-size: 32px;
        padding: 24px;
        padding-top: 20px;
        z-index: -1;
        letter-spacing: 1px;
        overflow: hidden;
      }
      .main {
        padding: calc(50vh - 214px) 0 0 calc(50vw - 520px);
        display: flex;
      }
      .div1 {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-left: 20px;
        height: 348px;
        width: 180px;
        padding-top: 30px;
        font-size: 26px;
      }
      button {
        border: 1px solid grey;
        border-radius: 3px;
        padding: 12px 16px;
        margin-top: 5px;
        cursor: pointer;
      }
      #score {
        font-size: 100px;
        margin: 25px auto;
      }
      #submit {
        margin-top: 28px;
        font-size: 28px;
        height: 60px;
        border: 2px solid gray;
        border-radius: 5px;
      }
      .div2 {
        display: flex;
        flex-direction: column;
      }
      #timer {
        height: 42px;
        font-size: 32px;
        padding-left: 20px;
      }
      .empty{
          height: 200px;
      }
    </style>
  </head>
  <body>
    <div id="text"><div class="empty"></div></div>
    <div class="main">
      <div class="div2">
        <div id="timer">0s</div>
        <textarea class="text" id="tarea" cols="30" rows="10"></textarea>
      </div>
      <div class="div1">
        <div id="score">0</div>
        <div>Score</div>
        <button id="submit">Next!!</button>
      </div>
    </div>
    <script>
      const textArray = [
        "away name to to said make play few than work light all last but small try answer time this next would really earth to see like tree each leave another year sun did all ask almost young the big men has a always even once carry new help best little think small must play carry saw why look day animal again for cut no earth or far first year few start will feet as name went face after out him animal cut large help change by here good say same",
        "life great her a tell put I where off us stop four and learn also were may four after high talk three why day into number but made as he may second miss our write think two let close plant just study number other sea her only leave by their letter second really which found state and far want then do found thing change mile play way them black line each water state us follow not sun girl water keep where took learn but large here people house with the",
        "with oil country at move new make as live kind now be us letter leave show must watch when house next after night at look set large again thing sound need around letter each close but time until house well their a book country song now take far went no family water his four tell have around might again in made he family hard name black group animal that about place make play food later thing there play close than life those have are long old face being open number",
        "then hand really carry went hand side spell seem went open it because form own large best mile after back also song important may has of if very at end page us why had right your to earth into call just live sun kind war would go little talk part next why now began like mile often our close in second into oil the point take animal time water school at where think mile good me many mother while most fall paper men even right see both white four idea",
        "took on life when kind need never along his who sun big name once their far try see just before until their answer enough walk carry boy stop below year give under page into each see sometimes what old move why state animal list no city every get sun both sea about how we you study home above sun number off was did fall help show back old hear begin man head white should father live often far small should group talk by while night small add at like he",
        "point out and after not change right look our along letter but ask only seem begin people before need river any only watch let do may add school do when said up put hard around be oil some did take paper an year or his as as help first until start most back what too are line been hard year man air small below sound name said how number add sea group take between cut above give letter country follow boy has last song say after got call school page",
        "head move home began we fire no these once upon long see might call and cut four every red white leave without so girl can long went open letter too until why my spell those say two day are think group important head not good group second was up have learn part your get large talk him try here feet start same know water tell can try word start up talk air good people is tree food him most use book did but hand be old put name book come",
      ];
      const tarea = document.querySelector("#tarea");
      const submit = document.querySelector("#submit");
      const reset = document.querySelector("#reset");
      const textdiv = document.querySelector("#text");
      const score = document.querySelector("#score");
      const timer = document.querySelector("#timer");

      var scoreval = 0;
      var start = 0;
      var time = 0;



      var incr = 0;
      var text = "";
      mainFn();
      var timeInterval;
      function mainFn() {
        text = textArray[incr % 7];
        // var str = "";
        // for (i = 0; i < text.length; i++) {
        //   str += "<letter>" + text[i] + "</letter>";
        // }
        // tarea.disabled=true;
        tarea.focus();
        tarea.value = "";
        var pointer = 0;
        var noOfWords=text.split(" ").length;
        var newLength=text.length-noOfWords+1;
        textdiv.innerHTML = text+"<div class='empty'></div>";

        tarea.onkeydown = (e) => {
          pointer = tarea.value.length + 1;
          if (pointer > 0 && e.key == text[pointer - 1] && e.key != " ") {
            scoreval += 1;
          } else if (scoreval > 0 && e.keyCode == 8) {
            if (
              text[pointer - 2] == tarea.value[pointer - 2] &&
              text[pointer - 2] != " "
            ) {
              scoreval -= 1;
            }
          }
          temp1 = getCurrentLine(tarea.value + "l");
          if (temp1 > 5) {
            tarea.scrollTop = (temp1 - 5) * 45;
          }
          score.innerHTML = scoreval;
          if(scoreval==newLength){
            setTimeout(submitfn, 200);
          }
          if (start == 0) {
            start = 1;
            timeInterval=setInterval(() => {
              time += 1;
              if (time > 60) {
                timer.innerHTML =
                  Math.floor(time / 60).toString() +
                  "m " +
                  (time % 60).toString() +
                  "s";
              } else {
                timer.innerHTML = time.toString() + "s";
              }
            }, 1000);
          }
        };
      }

      tarea.onscroll = () => {
        textdiv.scrollTop = tarea.scrollTop;
      };

      function preventDefaultForScrollKeys(e) {
        if (e.keyCode == 13) {
          e.preventDefault();
          return false;
        }
      }

      submit.onclick = submitfn;
      function submitfn(){
        start=0;
        clearInterval(timeInterval);
        timer.innerHTML="0s last score "+(Math.floor(scoreval*14/time)).toString()+" wpm";
        time=0;
        textdiv.scrollTop = 0;
        incr += 1;
        scoreval = 0;
        score.innerHTML = scoreval;
        text = textArray[incr % 7];
        mainFn();
      }

      tarea.addEventListener("keydown", preventDefaultForScrollKeys, false);
      function getCurrentLine(text) {
        var lineArray = [];
        y = 0;
        inc = 0;
        t = 0;
        words = text.split(" ");
        while (inc < words.length) {
          while (y <= 39 && inc < words.length) {
            t = y + words[inc].length + 1;
            if (t <= 39) {
              y = t;
              inc += 1;
            } else {
              break;
            }
          }
          lineArray.push(y);
          y = 0;
        }
        return lineArray.length;
      }
      function shuffleArray(array) {
        for (var i = array.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var temp = array[i];
          array[i] = array[j];
          array[j] = temp;
        }
      }
    </script>
  </body>
</html>
